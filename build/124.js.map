{"version":3,"sources":["../../src/addon/mod/assign/pages/submission-review/submission-review.module.ts","../../src/addon/mod/assign/pages/submission-review/submission-review.ts"],"names":[],"mappings":"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","file":"124.js","sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { CoreComponentsModule } from '@components/components.module';\nimport { CoreDirectivesModule } from '@directives/directives.module';\nimport { AddonModAssignComponentsModule } from '../../components/components.module';\nimport { AddonModAssignSubmissionReviewPage } from './submission-review';\n\n@NgModule({\n    declarations: [\n        AddonModAssignSubmissionReviewPage,\n    ],\n    imports: [\n        CoreComponentsModule,\n        CoreDirectivesModule,\n        AddonModAssignComponentsModule,\n        IonicPageModule.forChild(AddonModAssignSubmissionReviewPage),\n        TranslateModule.forChild()\n    ],\n})\nexport class AddonModAssignSubmissionReviewPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/assign/pages/submission-review/submission-review.module.ts","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, OnInit, ViewChild } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { CoreAppProvider } from '@providers/app';\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\nimport { CoreCourseProvider } from '@core/course/providers/course';\nimport { AddonModAssignProvider, AddonModAssignAssign } from '../../providers/assign';\nimport { AddonModAssignSubmissionComponent } from '../../components/submission/submission';\n\n/**\n * Page that displays a submission.\n */\n@IonicPage({ segment: 'addon-mod-assign-submission-review' })\n@Component({\n    selector: 'page-addon-mod-assign-submission-review',\n    templateUrl: 'submission-review.html',\n})\nexport class AddonModAssignSubmissionReviewPage implements OnInit {\n    @ViewChild(AddonModAssignSubmissionComponent) submissionComponent: AddonModAssignSubmissionComponent;\n\n    title: string; // Title to display.\n    moduleId: number; // Module ID the submission belongs to.\n    courseId: number; // Course ID the assignment belongs to.\n    submitId: number; //  User that did the submission.\n    blindId: number; // Blinded user ID (if it's blinded).\n    showGrade: boolean; // Whether to display the grade at start.\n    loaded: boolean; // Whether data has been loaded.\n    canSaveGrades: boolean; // Whether the user can save grades.\n\n    protected assign: AddonModAssignAssign; // The assignment the submission belongs to.\n    protected blindMarking: boolean; // Whether it uses blind marking.\n    protected forceLeave = false; // To allow leaving the page without checking for changes.\n\n    constructor(navParams: NavParams, protected navCtrl: NavController, protected courseProvider: CoreCourseProvider,\n            protected appProvider: CoreAppProvider, protected assignProvider: AddonModAssignProvider,\n            protected domUtils: CoreDomUtilsProvider) {\n\n        this.moduleId = navParams.get('moduleId');\n        this.courseId = navParams.get('courseId');\n        this.submitId = navParams.get('submitId');\n        this.blindId = navParams.get('blindId');\n        this.showGrade = !!navParams.get('showGrade');\n    }\n\n    /**\n     * Component being initialized.\n     */\n    ngOnInit(): void {\n        this.fetchSubmission().finally(() => {\n            this.loaded = true;\n        });\n    }\n\n    /**\n     * Check if we can leave the page or not.\n     *\n     * @return Resolved if we can leave it, rejected if not.\n     */\n    ionViewCanLeave(): boolean | Promise<void> {\n        if (!this.submissionComponent || this.forceLeave) {\n            return true;\n        }\n\n        // Check if data has changed.\n        return this.submissionComponent.canLeave();\n    }\n\n    /**\n     * User entered the page.\n     */\n    ionViewDidEnter(): void {\n        this.submissionComponent && this.submissionComponent.ionViewDidEnter();\n    }\n\n    /**\n     * User left the page.\n     */\n    ionViewDidLeave(): void {\n        this.submissionComponent && this.submissionComponent.ionViewDidLeave();\n    }\n\n    /**\n     * Get the submission.\n     *\n     * @return Promise resolved when done.\n     */\n    protected fetchSubmission(): Promise<any> {\n        return this.assignProvider.getAssignment(this.courseId, this.moduleId).then((assignment) => {\n            this.assign = assignment;\n            this.title = this.assign.name;\n\n            this.blindMarking = this.assign.blindmarking && !this.assign.revealidentities;\n\n            return this.courseProvider.getModuleBasicGradeInfo(this.moduleId).then((gradeInfo) => {\n                if (gradeInfo) {\n                    // Grades can be saved if simple grading.\n                    if (gradeInfo.advancedgrading && gradeInfo.advancedgrading[0] &&\n                            typeof gradeInfo.advancedgrading[0].method != 'undefined') {\n\n                        const method = gradeInfo.advancedgrading[0].method || 'simple';\n                        this.canSaveGrades = method == 'simple';\n                    } else {\n                        this.canSaveGrades = true;\n                    }\n                }\n            });\n        });\n    }\n\n    /**\n     * Refresh all the data.\n     *\n     * @return Promise resolved when done.\n     */\n    protected refreshAllData(): Promise<any> {\n        const promises = [];\n\n        promises.push(this.assignProvider.invalidateAssignmentData(this.courseId));\n        if (this.assign) {\n            promises.push(this.assignProvider.invalidateSubmissionData(this.assign.id));\n            promises.push(this.assignProvider.invalidateAssignmentUserMappingsData(this.assign.id));\n            promises.push(this.assignProvider.invalidateSubmissionStatusData(this.assign.id, this.submitId, undefined,\n                this.blindMarking));\n        }\n\n        return Promise.all(promises).finally(() => {\n            this.submissionComponent && this.submissionComponent.invalidateAndRefresh();\n\n            return this.fetchSubmission();\n        });\n    }\n\n    /**\n     * Refresh the data.\n     *\n     * @param refresher Refresher.\n     */\n    refreshSubmission(refresher: any): void {\n        this.refreshAllData().finally(() => {\n            refresher.complete();\n        });\n    }\n\n    /**\n     * Submit a grade and feedback.\n     */\n    submitGrade(): void {\n        if (this.submissionComponent) {\n            this.submissionComponent.submitGrade().then(() => {\n                // Grade submitted, leave the view if not in tablet.\n                if (!this.appProvider.isWide()) {\n                    this.forceLeave = true;\n                    this.navCtrl.pop();\n                }\n            }).catch((error) => {\n                this.domUtils.showErrorModalDefault(error, 'core.error', true);\n            });\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/assign/pages/submission-review/submission-review.ts"],"sourceRoot":""}