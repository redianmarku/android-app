{"version":3,"sources":["../../src/core/settings/pages/space-usage/space-usage.module.ts","../../src/core/settings/pages/space-usage/space-usage.ts"],"names":[],"mappings":"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","file":"25.js","sourcesContent":["// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { CoreSettingsSpaceUsagePage } from './space-usage';\nimport { CoreComponentsModule } from '@components/components.module';\nimport { CoreDirectivesModule } from '@directives/directives.module';\nimport { CorePipesModule } from '@pipes/pipes.module';\n\n@NgModule({\n    declarations: [\n        CoreSettingsSpaceUsagePage\n    ],\n    imports: [\n        CoreComponentsModule,\n        CoreDirectivesModule,\n        CorePipesModule,\n        IonicPageModule.forChild(CoreSettingsSpaceUsagePage),\n        TranslateModule.forChild()\n    ],\n})\nexport class CoreSettingsSpaceUsagePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/settings/pages/space-usage/space-usage.module.ts","// (C) Copyright 2015 Moodle Pty Ltd.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport { Component, } from '@angular/core';\nimport { IonicPage } from 'ionic-angular';\nimport { TranslateService } from '@ngx-translate/core';\nimport { CoreSitesProvider, CoreSiteBasicInfo } from '@providers/sites';\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\nimport { CoreSettingsHelper, CoreSiteSpaceUsage } from '../../providers/helper';\n\n/**\n * Page that displays the space usage settings.\n */\n@IonicPage({segment: 'core-settings-space-usage'})\n@Component({\n    selector: 'page-core-settings-space-usage',\n    templateUrl: 'space-usage.html',\n})\nexport class CoreSettingsSpaceUsagePage {\n\n    loaded = false;\n    sites = [];\n    currentSiteId = '';\n    totals: CoreSiteSpaceUsage = {\n        cacheEntries: 0,\n        spaceUsage: 0\n    };\n\n    constructor(protected sitesProvider: CoreSitesProvider,\n            protected settingsHelper: CoreSettingsHelper,\n            protected domUtils: CoreDomUtilsProvider,\n            protected translate: TranslateService,\n    ) {\n        this.currentSiteId = this.sitesProvider.getCurrentSiteId();\n    }\n\n    /**\n     * View loaded.\n     */\n    ionViewDidLoad(): void {\n        this.loadSiteData().finally(() => {\n            this.loaded = true;\n        });\n    }\n\n    /**\n     * Convenience function to load site data/usage and calculate the totals.\n     *\n     * @return Resolved when done.\n     */\n    protected async loadSiteData(): Promise<void> {\n        // Calculate total usage.\n        let totalSize = 0;\n        let totalEntries = 0;\n\n        this.sites = await this.sitesProvider.getSortedSites();\n\n        // Get space usage.\n        await Promise.all(this.sites.map(async (site) => {\n            const siteInfo = await this.settingsHelper.getSiteSpaceUsage(site.id);\n\n            site.cacheEntries = siteInfo.cacheEntries;\n            site.spaceUsage = siteInfo.spaceUsage;\n\n            totalSize += (site.spaceUsage ? parseInt(site.spaceUsage, 10) : 0);\n            totalEntries += (site.cacheEntries ? parseInt(site.cacheEntries, 10) : 0);\n        }));\n\n        this.totals.spaceUsage = totalSize;\n        this.totals.cacheEntries = totalEntries;\n    }\n\n    /**\n     * Refresh the data.\n     *\n     * @param refresher Refresher.\n     */\n    refreshData(refresher: any): void {\n        this.loadSiteData().finally(() => {\n            refresher.complete();\n        });\n    }\n\n    /**\n     * Deletes files of a site and the tables that can be cleared.\n     *\n     * @param siteData Site object with space usage.\n     */\n    deleteSiteStorage(siteData: CoreSiteBasicInfoWithUsage): void {\n        this.settingsHelper.deleteSiteStorage(siteData.siteName, siteData.id).then((newInfo) => {\n            this.totals.spaceUsage -= siteData.spaceUsage - newInfo.spaceUsage;\n            this.totals.spaceUsage -= siteData.cacheEntries - newInfo.cacheEntries;\n            siteData.spaceUsage = newInfo.spaceUsage;\n            siteData.cacheEntries = newInfo.cacheEntries;\n        }).catch(() => {\n            // Ignore cancelled confirmation modal.\n        });\n    }\n\n    /**\n     * Show information about space usage actions.\n     */\n    showInfo(): void {\n        this.domUtils.showAlert(this.translate.instant('core.help'),\n            this.translate.instant('core.settings.spaceusagehelp'));\n    }\n}\n\n/**\n * Basic site info with space usage and cache entries that can be erased.\n */\nexport interface CoreSiteBasicInfoWithUsage extends CoreSiteBasicInfo {\n    cacheEntries?: number; // Number of cached entries that can be cleared.\n    spaceUsage?: number; // Space used in this site.\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/settings/pages/space-usage/space-usage.ts"],"sourceRoot":""}